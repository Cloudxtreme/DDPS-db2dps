<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<title>Status</title>
	<meta name="subtitle" content="Status"/>
	<meta name="author" content="Niels Thomas Haugård"/>
	<meta name="date" content="Tor  6 Apr 2017 16:27:21 CEST"/>
	<meta name="version" content="1.0-11-7-gba79895-dirty 1.0-11"/>
	<meta name="shorttitle" content="D"/>
	<meta name="series" content="SSI"/>
	<meta name="seriesindex" content=""/>
	<meta name="tags" content="SSI"/>
	<meta name="cover" content="coverpage.pdf"/>
	<link type="text/css" rel="stylesheet" href="assets/CSS/i2-Book.css"/>
<link rel="stylesheet" href="assets/CSS/googlecode.css"> <script src="assets/CSS/highlight.min.js"></script> <script>hljs.initHighlightingOnLoad();</script>
	<meta name="files" content=""/>
</head>
<body>

<h3 id="rulecreation">Rule creation</h3>

<p>Just my random thoughts, but having to implement something I wonder what is the
<em>best practice for creating rules to mitigate volumetric attacks based on flowspec</em>?</p>

<p>According to
<a href="https://d0.awsstatic.com/whitepapers/DDoS_White_Paper_June2015.pdf">awsstatic.com</a>
DDoS attacks are most common at layers 3, 4, 6, and 7 of the Open Systems
Interconnection (OSI) model.</p>

<p>Layer 3 and 4 attacks correspond to the Network and Transport layers of the OSI
model: these are volumetric infrastructure layer attacks.</p>

<p>Layer 6 and 7 attacks correspond to the Presentation and Application layers of
the OSI model, these are as application layer attacks and only the volumetric
attacks can be detected by fastnetmon.</p>

<table>
<colgroup>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:left;">#</th>
	<th style="text-align:left;">Layer</th>
	<th style="text-align:left;">Unit</th>
	<th style="text-align:left;">Description</th>
	<th style="text-align:left;">Vector Examples</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;">7</td>
	<td style="text-align:left;">Application</td>
	<td style="text-align:left;">Data</td>
	<td style="text-align:left;">Network process to application</td>
	<td style="text-align:left;">HTTP floods, DNS query floods</td>
</tr>
<tr>
	<td style="text-align:left;">6</td>
	<td style="text-align:left;">Presentation</td>
	<td style="text-align:left;">Data</td>
	<td style="text-align:left;">Data representation and encryption</td>
	<td style="text-align:left;">SSL abuse</td>
</tr>
<tr>
	<td style="text-align:left;">5</td>
	<td style="text-align:left;">Session</td>
	<td style="text-align:left;">Data</td>
	<td style="text-align:left;">Interhost communication</td>
	<td style="text-align:left;">N/A</td>
</tr>
<tr>
	<td style="text-align:left;">4</td>
	<td style="text-align:left;">Transport</td>
	<td style="text-align:left;">Segments</td>
	<td style="text-align:left;">End-to-end connections and reliability</td>
	<td style="text-align:left;">SYN floods</td>
</tr>
<tr>
	<td style="text-align:left;">3</td>
	<td style="text-align:left;">Network</td>
	<td style="text-align:left;">Packets</td>
	<td style="text-align:left;">Path determination and logical addressing</td>
	<td style="text-align:left;">UDP reflection attacks</td>
</tr>
<tr>
	<td style="text-align:left;">2</td>
	<td style="text-align:left;">Data Link</td>
	<td style="text-align:left;">Frames</td>
	<td style="text-align:left;">Physical addressing</td>
	<td style="text-align:left;">N/A</td>
</tr>
<tr>
	<td style="text-align:left;">1</td>
	<td style="text-align:left;">Physical</td>
	<td style="text-align:left;">Bits</td>
	<td style="text-align:left;">Media, signal, and binary transmission</td>
	<td style="text-align:left;">N/A</td>
</tr>
</tbody>
</table>
<p><em>From <a href="https://d0.awsstatic.com/whitepapers/DDoS_White_Paper_June2015.pdf">awsstatic.com</a></em></p>

<div style="page-break-before: always"> &nbsp;</div>

<p>Fastnetmon detects the following type of attacks:</p>

<ol>
<li><em>syn_flood</em>: TCP packets with enabled SYN flag</li>
<li><em>udp_flood</em>: flood with UDP packets (so recently in result of amplification)</li>
<li><em>icmp flood</em>: flood with ICMP packets</li>
<li><em>ip_fragmentation_flood</em>: IP packets with MF flag set or with non zero fragment offset</li>
<li><em>DNS amplification</em>:</li>
<li><em>NTP amplification</em>:</li>
<li><em>SSDP amplification</em>:</li>
<li><em>SNMP amplification</em>:</li>
</ol>

<p>First: it is sometimes possible to distinguish between legitimate and illegitimate packets, as
<a href="https://danielmiessler.com/study/synpackets/">Not All SYNs Are Created Equal</a>.
And empty UDP and TCP packet might be rare:</p>

<p>For ethernet is the <em>minimum payload</em> 42 octets when an 802.1Q tag is present and
46 octets when absent according to <a href="https://en.wikipedia.org/wiki/Ethernet_frame">wikipedia on ethernet
frames</a>. The minimum Layer 2
Ethernet frame size is 64 bytes for an <em>empty tcp or udp packet</em>.</p>

<figure>
<img src="https://nmap.org/book/images/hdr/MJB-TCP-Header-800x564.png" alt="" /></figure>



<div style="page-break-before: always"> &nbsp;</div>

<p>We have the following values for creating a filter:</p>

<pre><code>Type 1 - Destination Prefix
Type 2 - Source Prefix
Type 3 - IP Protocol
Type 4 – Source or Destination Port
Type 5 – Destination Port
Type 6 - Source Port
Type 7 – ICMP Type
Type 8 – ICMP Code
Type 9 - TCP flags
Type 10 - Packet length
Type 11 – DSCP
Type 12 - Fragment Encoding
</code></pre>

<p>Suggestion for rule creation:</p>

<table>
<colgroup>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:left;">Attack type</th>
	<th style="text-align:left;">Mitigation</th>
	<th style="text-align:left;">Match on</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;">syn_flood</td>
	<td style="text-align:left;">rate-limit</td>
	<td style="text-align:left;">tcp option (syn) protocol, destination port, tcp flags, size, (ttl would be nice but <a href="https://tools.ietf.org/id/draft-ietf-idr-bgp-flowspec-label-00.txt">is still in draft</a>), and source any</td>
</tr>
<tr>
	<td style="text-align:left;">udp_flood</td>
	<td style="text-align:left;">rate-limit</td>
	<td style="text-align:left;">protocol and destination host and port</td>
</tr>
<tr>
	<td style="text-align:left;">icmp flood</td>
	<td style="text-align:left;">discard</td>
	<td style="text-align:left;">protocol and destination</td>
</tr>
<tr>
	<td style="text-align:left;">ip_fragmentation_flood</td>
	<td style="text-align:left;">rate-limit</td>
	<td style="text-align:left;">protocol and destination</td>
</tr>
<tr>
	<td style="text-align:left;">DNS amplification</td>
	<td style="text-align:left;">rate-limit</td>
	<td style="text-align:left;">protocol, port and destination</td>
</tr>
<tr>
	<td style="text-align:left;">NTP amplification</td>
	<td style="text-align:left;">rate-limit</td>
	<td style="text-align:left;">protocol, port and destination</td>
</tr>
<tr>
	<td style="text-align:left;">SSDP amplification</td>
	<td style="text-align:left;">discard</td>
	<td style="text-align:left;">protocol, port 1900, source any</td>
</tr>
<tr>
	<td style="text-align:left;">SNMP amplification</td>
	<td style="text-align:left;">discard</td>
	<td style="text-align:left;">protocol, port, destination</td>
</tr>
</tbody>
</table>
<p>Note: SSDP - <em>Simple Service Discovery Protocol</em> (see <a href="http://quimby.gnus.org/internet-drafts/draft-cai-ssdp-v1-03.txt">draft-cai-ssdp-v1&#8211;03</a> does not belong on a WAN an anyway? It&#8217;s used
for UPnP discovery. The same goes for TCP / UDP port 1 - 19.</p>

<p>SNMP does to my best understanding not pass the boundaries of a company
network, even not protocol version 3. And sacrificing monitoring data for
the sake of the network is fine with me.</p>

</body>
</html>
